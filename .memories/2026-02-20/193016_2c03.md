---
id: checkpoint_2c031483
timestamp: 2026-02-20T19:30:16.458Z
tags:
  - eros
  - bugfix
  - storage
  - dimension-mismatch
git:
  branch: main
  commit: e2b59d0
  files:
    - .julie/.gitignore
    - .memories/2026-02-20/190733_8b49.md
    - .memories/2026-02-20/191255_8b60.md
    - .memories/2026-02-20/191552_d249.md
    - .memories/2026-02-20/191956_b10a.md
    - .memories/2026-02-20/192730_2877.md
    - CLAUDE.md
    - EROS_AGENT_INSTRUCTIONS.md
    - pyproject.toml
    - python/eros/chunking.py
    - python/eros/config.py
    - python/eros/embeddings.py
    - python/eros/retrieval.py
    - python/eros/server.py
    - python/eros/storage.py
    - python/tests/test_chunking.py
    - uv.lock
summary: "## Fixed dimension mismatch bug in VectorStorage.clear_collection"
---

## Fixed dimension mismatch bug in VectorStorage.clear_collection

### What
`clear_collection()` was recreating tables with the **old** vector dimensions after dropping them. When switching from a 384D model (bge-small) to a 768D model (CodeRankEmbed), the recreated table still had 384D schema, causing a LanceDB cast error on insert.

### Fix
Simplified `clear_collection()` to just drop the table and remove it from the in-memory cache. The table is recreated with the correct dimension on the next `add_chunks()` call via `_get_or_create_table(collection, dim)`.

### Impact
- Fixes model switching (any dimension change now works cleanly)
- 55/55 tests passing
- Server restart needed to pick up the fix + use new CodeRankEmbed model
