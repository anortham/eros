---
id: checkpoint_f71c5a35
timestamp: 2026-02-25T02:19:10.970Z
tags:
  - eros
  - performance
  - incremental-indexing
  - refresh
  - tests
git:
  branch: main
  commit: ca188f4
  files:
    - .memories/2026-02-25/021020_01aa.md
    - python/eros/config.py
    - python/eros/incremental.py
    - python/eros/indexing.py
    - python/eros/julie_reader.py
    - python/eros/retrieval.py
    - python/eros/storage.py
    - python/tests/test_julie_reader.py
    - python/tests/test_retrieval.py
summary: "## Implemented incremental indexing to reduce re-embedding work"
planId: add-file-logging-timing-instrumentation-to-eros
type: checkpoint
confidence: 5
---

## Implemented incremental indexing to reduce re-embedding work

- **WHAT:** Added manifest-based incremental refresh for code/docs and split indexing logic into a dedicated module.
- **WHY:** `semantic_index(operation='refresh')` was effectively re-indexing everything and creating duplicate rows, making embedding unbearably slow on repeated runs.
- **HOW:**
  - Added `IndexManifest` + file hash delta logic in `python/eros/incremental.py`.
  - Added `python/eros/indexing.py` to own build/refresh behavior and keep `retrieval.py` below size limit.
  - `build_index()` now:
    - reads Julie file hashes per workspace,
    - computes changed/removed files,
    - deletes affected rows only,
    - embeds only changed files,
    - records fresh manifest state.
  - Added `VectorStorage.delete_where()` for targeted row deletion.
  - Extended `JulieReader` with:
    - `read_symbols(..., file_paths=...)`
    - `read_file_contents(file_paths=...)`
    - `read_file_hashes()`
  - Hardened SQL literal handling by escaping filter values via `sql_quote()` in retrieval queries.

### Tests added/updated
- `python/tests/test_retrieval.py`
  - `test_refresh_unchanged_does_not_duplicate_chunks`
- `python/tests/test_julie_reader.py`
  - file-path symbol filtering
  - selected-file content reads
  - file hash reads

### Verification
- `uv run pytest -q --tb=short python/tests/test_julie_reader.py python/tests/test_retrieval.py` → passed
- `uv run pytest -q --tb=short python/tests/` → **98 passed**
- `uv run ruff check python/eros python/tests` → passed

### Impact
- Repeated refreshes now skip unchanged files and avoid index growth from duplicates.
- Large projects should see much faster steady-state indexing after initial build.

